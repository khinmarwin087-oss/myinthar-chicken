<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’ Admin - á€™á€¼á€„á€ºá€á€¬</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --dark: #0f172a; --card: #1e293b; --green: #22c55e; }
        body { font-family: 'Pyidaungsu', sans-serif; background: var(--dark); color: white; margin: 0; padding-bottom: 50px; }
        #login-screen { position: fixed; inset: 0; background: var(--dark); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .nav { background: var(--card); padding: 15px; display: flex; justify-content: space-between; border-bottom: 1px solid #334155; position: sticky; top: 0; z-index: 100; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 15px; border-left: 5px solid var(--gold); }
        .section-title { padding: 15px 15px 5px 15px; color: var(--gold); font-weight: bold; font-size: 18px; }
        .order-card { background: var(--card); margin: 0 15px 15px 15px; padding: 15px; border-radius: 15px; border: 1px solid #334155; }
        .btn { padding: 8px 15px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-family: 'Pyidaungsu'; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-done { background: var(--green); color: white; width: 100%; margin-top: 10px; }
        .item-list { font-size: 13px; color: #94a3b8; margin: 5px 0; }
        input { padding: 12px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="login-screen">
    <div style="background:var(--card); padding:30px; border-radius:20px; width:300px; text-align:center; border: 1px solid var(--gold);">
        <h2 style="color:var(--gold)">Admin Access</h2>
        <input type="password" id="pass" placeholder="Password á€›á€­á€¯á€€á€ºá€•á€«">
        <button class="btn btn-gold" style="width:100%" onclick="login()">LOGIN</button>
    </div>
</div>

<div id="admin-main" style="display:none">
    <div class="nav">
        <button class="btn" onclick="location.href='index.html'">â¬… Back</button>
        <span style="color:var(--gold); font-weight:bold;">á€™á€¼á€„á€ºá€á€¬ - á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€™á€¾á€¯</span>
        <button class="btn" style="background:#ef4444; color:white;" onclick="location.reload()">Logout</button>
    </div>

    <div style="padding:15px">
        <div style="background:var(--card); padding:15px; border-radius:15px; display:flex; justify-content:space-between; align-items:center;">
            <span>ğŸª á€†á€­á€¯á€„á€º á€¡á€–á€½á€„á€·á€º/á€¡á€•á€­á€á€º</span>
            <button id="shop-btn" class="btn" onclick="toggleShop()">...</button>
        </div>
    </div>

    <div class="stat-grid">
        <div class="stat-card">
            <small>á€šá€”á€±á€· á€¡á€›á€±á€¬á€„á€ºá€¸</small><br>
            <b style="font-size:20px; color:var(--gold)" id="sale-val">0 K</b>
        </div>
        <div class="stat-card">
            <small>á€šá€”á€±á€· á€¡á€™á€¼á€á€º</small><br>
            <b style="font-size:20px; color:var(--green);" id="profit-val">0 K</b>
        </div>
    </div>

    <div class="section-title">ğŸ“ á€¡á€±á€¬á€ºá€’á€«á€¡á€á€…á€ºá€™á€»á€¬á€¸ (Pending)</div>
    <div id="order-list">á€¡á€±á€¬á€ºá€’á€«á€™á€»á€¬á€¸ á€†á€½á€²á€šá€°á€”á€±á€á€Šá€º...</div>

    <div class="section-title">ğŸ¥˜ Menu á€…á€®á€™á€¶á€á€¼á€„á€ºá€¸</div>
    <div style="padding:0 15px">
        <div style="background:var(--card); padding:15px; border-radius:15px;">
            <input type="text" id="m-name" placeholder="á€¡á€™á€Šá€º (á€¥á€•á€™á€¬- á€€á€¼á€€á€ºá€•á€±á€«á€„á€º)">
            <input type="number" id="m-price" placeholder="á€›á€±á€¬á€„á€ºá€¸á€…á€»á€±á€¸">
            <input type="number" id="m-cost" placeholder="á€¡á€›á€„á€ºá€¸á€…á€»á€±á€¸">
            <input type="number" id="m-stock" placeholder="Stock">
            <button class="btn btn-gold" style="width:100%" onclick="saveMenu()">Menu á€¡á€á€…á€ºá€‘á€Šá€·á€ºá€™á€Šá€º</button>
        </div>
        <div id="menu-list" style="margin-top:20px"></div>
    </div>
</div>

<script>
    const SB_URL = "https://deabtvqzxpkepgcdutzd.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlYWJ0dnF6eHBrZXBnY2R1dHpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNzQzNDMsImV4cCI6MjA4MTg1MDM0M30.BbxmM65uoTDcf_nTP6w5siSF6Y5_eM4peqYJCAxR90I";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

    function login() {
        if(document.getElementById('pass').value === "2012@Yewin") {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-main').style.display = 'block';
            loadAdminData();
            // Real-time Update á€¡á€á€½á€€á€º á… á€…á€€á€¹á€€á€”á€·á€ºá€á€…á€ºá€á€« á€•á€¼á€”á€ºá€á€±á€«á€ºá€™á€Šá€º
            setInterval(loadAdminData, 5000);
        } else { alert("Password á€™á€¾á€¬á€¸á€šá€½á€„á€ºá€¸á€”á€±á€•á€«á€á€Šá€ºá‹"); }
    }

    async function loadAdminData() {
        fetchShop();
        fetchStats();
        fetchOrders();
        fetchMenus();
    }

    async function fetchShop() {
        const { data } = await _supabase.from('shop_settings').select('*').single();
        const btn = document.getElementById('shop-btn');
        btn.innerText = data.is_open ? "OPEN (á€–á€½á€„á€·á€ºá€‘á€¬á€¸á€á€Šá€º)" : "CLOSED (á€•á€­á€á€ºá€‘á€¬á€¸á€á€Šá€º)";
        btn.style.background = data.is_open ? "#22c55e" : "#ef4444";
    }

    async function toggleShop() {
        const cur = document.getElementById('shop-btn').innerText.includes("OPEN");
        await _supabase.from('shop_settings').update({ is_open: !cur }).eq('id', 1);
        fetchShop();
    }

    async function fetchStats() {
        const today = new Date().toISOString().split('T')[0];
        const { data: orders } = await _supabase.from('orders').select('*').gte('created_at', today).eq('order_status', 'completed');
        
        let sales = 0;
        let profit = 0;
        orders.forEach(o => {
            sales += o.total;
            // á€šá€¬á€šá€®á€¡á€¬á€¸á€–á€¼á€„á€·á€º á€¡á€›á€±á€¬á€„á€ºá€¸á€›á€²á€· á‚á…% á€€á€­á€¯ á€¡á€™á€¼á€á€ºá€á€½á€€á€ºá€•á€¼á€‘á€¬á€¸á€á€¼á€„á€ºá€¸
            profit += o.total * 0.25; 
        });
        document.getElementById('sale-val').innerText = sales.toLocaleString() + " K";
        document.getElementById('profit-val').innerText = profit.toLocaleString() + " K";
    }

    async function fetchOrders() {
        const { data } = await _supabase.from('orders').select('*').eq('order_status', 'pending').order('created_at', { ascending: false });
        const list = document.getElementById('order-list');
        if (data.length === 0) { list.innerHTML = "<p style='text-align:center; color:#64748b;'>á€¡á€±á€¬á€ºá€’á€«á€¡á€á€…á€ºá€™á€›á€¾á€­á€á€±á€¸á€•á€«á‹</p>"; return; }
        
        list.innerHTML = data.map(o => `
            <div class="order-card">
                <div style="display:flex; justify-content:space-between">
                    <b>ğŸ‘¤ ${o.customer_name}</b>
                    <small style="color:var(--gold)">#${o.id}</small>
                </div>
                <div style="font-size:13px; margin:5px 0;">ğŸ“ ${o.phone} | ğŸ•’ ${o.pickup_time}</div>
                <div class="item-list">ğŸ“¦ ${o.items}</div>
                <div style="text-align:right; font-weight:bold; color:var(--gold)">${o.total.toLocaleString()} K</div>
                <button class="btn btn-done" onclick="completeOrder(${o.id})">âœ… á€•á€¼á€®á€¸á€•á€¼á€® (Completed)</button>
            </div>
        `).join('');
    }

    async function completeOrder(id) {
        await _supabase.from('orders').update({ order_status: 'completed' }).eq('id', id);
        loadAdminData();
    }

    async function fetchMenus() {
        const { data } = await _supabase.from('menu_items').select('*').order('name');
        document.getElementById('menu-list').innerHTML = data.map(m => `
            <div style="background:var(--card); padding:12px; border-radius:12px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center; border: 1px solid #334155;">
                <div>
                    <b>${m.name}</b><br>
                    <small>${m.price} K | Stock: ${m.stock_qty}</small>
                </div>
                <button onclick="delMenu(${m.id})" style="background:#ef4444; color:white; border:none; padding:8px; border-radius:8px; cursor:pointer;">á€–á€»á€€á€º</button>
            </div>
        `).join('');
    }

    async function saveMenu() {
        const n = document.getElementById('m-name').value;
        const p = document.getElementById('m-price').value;
        const c = document.getElementById('m-cost').value;
        const s = document.getElementById('m-stock').value;
        if(!n || !p) return alert("á€¡á€™á€Šá€ºá€”á€¾á€„á€·á€º á€…á€»á€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€‘á€Šá€·á€ºá€•á€«á‹");
        await _supabase.from('menu_items').insert([{ name: n, price: p, cost_price: c, stock_qty: s }]);
        loadAdminData();
        // Clear inputs
        document.getElementById('m-name').value = '';
        document.getElementById('m-price').value = '';
    }

    async function delMenu(id) {
        if(confirm("á€¤ Menu á€€á€­á€¯ á€–á€»á€€á€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) {
            await _supabase.from('menu_items').delete().eq('id', id);
            fetchMenus();
        }
    }
</script>
</body>
</html>


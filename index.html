<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçó ·Äô·Äº·ÄÑ·Ä∫·Äû·Ä¨·ÄÄ·Äº·ÄÄ·Ä∫·ÄÄ·ÄÑ·Ä∫ POS - Smart Store</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --amazon-orange: #febd69; --amazon-gold: #f0c14b; --dark: #131921; --bg: #eaeded; }
        body { font-family: 'Pyidaungsu', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #111; }
        .container { max-width: 500px; margin: auto; background: white; min-height: 100vh; }
        
        /* Amazon Header */
        header { background: var(--dark); color: white; padding: 12px; display: flex; align-items: center; justify-content: space-between; }
        .nav-tabs { display: flex; background: #232f3e; overflow-x: auto; }
        .nav-tabs button { flex: 1; padding: 12px; border: none; background: none; color: white; cursor: pointer; font-family: 'Pyidaungsu'; font-size: 13px; opacity: 0.8; }
        .nav-tabs button.active { opacity: 1; border-bottom: 3px solid var(--amazon-orange); font-weight: bold; }

        .content { padding: 15px; }
        .hidden { display: none !important; }
        
        /* Item Style */
        .item-card { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #ddd; }
        .price { color: #B12704; font-weight: bold; font-size: 16px; }
        .qty-btn { background: #e7e9ec; border: 1px solid #adb1b8; border-radius: 3px; width: 35px; height: 35px; cursor: pointer; }

        /* Checkout Card */
        .payment-box { background: #fcf5ee; border: 1px solid #fbd8b4; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .pay-info { background: white; border: 1px solid #ddd; padding: 10px; border-radius: 5px; margin-bottom: 10px; text-align: center; }
        
        /* Admin Order List */
        .order-card { background: white; border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .detail-line { display: flex; justify-content: space-between; font-size: 13px; margin: 3px 0; }

        /* Amazon Style Buttons */
        .btn-amazon { background: linear-gradient(to bottom, #f7dfa5, #f0c14b); border: 1px solid #a88734; border-radius: 3px; width: 100%; padding: 12px; font-weight: bold; cursor: pointer; }
        .footer-cart { position: fixed; bottom: 0; max-width: 500px; width: 100%; background: white; border-top: 1px solid #ddd; padding: 15px; box-sizing: border-box; z-index: 100; }
        
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #888; border-radius: 3px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <span style="font-weight:bold; font-size:18px;">Myinthar Chicken</span>
        <span id="header-time" style="font-size:12px;"></span>
    </header>

    <div class="nav-tabs">
        <button id="tab-shop" class="active" onclick="showTab('shop')">SHOP</button>
        <button id="tab-myorders" onclick="showTab('myorders')">ORDERS</button>
        <button id="tab-admin" onclick="showTab('admin')">ADMIN</button>
    </div>

    <div id="sec-shop" class="content">
        <div style="background:#f3f3f3; padding:10px; border-radius:5px; margin-bottom:15px;">
            <input type="text" id="cust_name" placeholder="·Äù·Äö·Ä∫·Äö·Ä∞·Äû·Ä∞·Ä°·Äô·Ää·Ä∫">
            <input type="tel" id="cust_phone" placeholder="·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫">
        </div>
        <div id="item-list"></div>
    </div>

    <div id="sec-pay" class="content hidden">
        <h3 style="margin-top:0;">Finalize Your Order</h3>
        <div id="voucher-summary" class="order-card" style="background:#fff9f0;"></div>
        
        <div class="payment-box">
            <p style="font-weight:bold; margin-top:0;">üí∞ ·ÄÑ·ÄΩ·Ä±·Äï·Ä±·Ä∏·ÄÅ·Äª·Ä±·Äõ·Äî·Ä∫ (KPay / AYA Pay)</p>
            <div class="pay-info">
                <span style="font-size:18px; color:#B12704; font-weight:bold;">09767287345</span><br>
                <small>(U Ye Win)</small>
            </div>
            <p style="font-size:12px; color:#555;">·Ä°·Äï·Ä±·Ä´·Ä∫·ÄÄ·Äî·Ä∂·Äï·Ä´·Äê·Ä∫·ÄÄ·Ä≠·ÄØ ·ÄÑ·ÄΩ·Ä±·Äú·ÄΩ·Äæ·Ä≤·Äï·Äº·ÄÆ·Ä∏·Äú·Äª·Äæ·ÄÑ·Ä∫ Screenshot ·Äê·ÄÑ·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´·Åã</p>
            <input type="file" id="pay_file" accept="image/*">
            <input type="text" id="pay_txid" placeholder="Transaction ID (·Äî·Ä±·Ä¨·ÄÄ·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏ ·ÅÜ ·Äú·ÄØ·Ä∂·Ä∏)">
        </div>
        <button class="btn-amazon" onclick="submitFinalOrder()">·Äô·Äæ·Ä¨·Äö·Ä∞·Äô·Äæ·ÄØ·ÄÄ·Ä≠·ÄØ ·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äô·Ää·Ä∫</button>
        <button onclick="showTab('shop')" style="width:100%; background:none; border:none; color:#0066c0; margin-top:10px;">Back to Menu</button>
    </div>

    <div id="sec-admin" class="content hidden">
        <div id="admin-auth">
            <input type="password" id="adm-pass" placeholder="Admin Password">
            <button class="btn-amazon" onclick="adminLogin()">Login</button>
        </div>
        <div id="admin-panel" class="hidden">
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <div style="flex:1; background:var(--dark); color:white; padding:10px; border-radius:5px; text-align:center;">
                    <small>Today Sales</small><br><b id="adm-total">0</b> K
                </div>
                <div style="flex:1; background:var(--amazon-gold); padding:10px; border-radius:5px; text-align:center;">
                    <small>Orders</small><br><b id="adm-count">0</b>
                </div>
            </div>
            <h4>·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏ ·Ä°·Äû·Ä±·Ä∏·ÄÖ·Ä≠·Äê·Ä∫</h4>
            <div id="adm-order-list"></div>
        </div>
    </div>

    <div id="cart-footer" class="footer-cart">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <span style="font-weight:bold;">Subtotal:</span>
            <span class="price"><span id="total-val">0</span> MMK</span>
        </div>
        <button class="btn-amazon" onclick="goToPay()">·Äô·Äæ·Ä¨·Äö·Ä∞·Äõ·Äî·Ä∫ ·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Ä¨·Ä∏·Äô·Ää·Ä∫</button>
    </div>
</div>

<script>
    const SB_URL = "https://ltusknkpwbyriikeyday.supabase.co";
    const SB_KEY = "sb_publishable_u9Y8SIpzqsT4WkyONV4J2w__Xwc09Fv";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

    const TG_TOKEN = "8215695761:AAF1qDjAJn7gjiHyzf8t7W6c8e51cim98sU";
    const TG_CHAT_ID = "8116152317";

    const menu = [
        {id:1, name:'·ÄÄ·Äº·ÄÄ·Ä∫·Äï·Ä±·Ä´·ÄÑ·Ä∫', price:4000}, {id:2, name:'·ÄÄ·Äº·ÄÄ·Ä∫·Äõ·ÄÑ·Ä∫·Ä°·ÄØ·Ä∂', price:4000}, {id:3, name:'·ÄÜ·Ä≠·Äê·Ä∫·Äû·Ä¨·Ä∏·ÄÄ·ÄÑ·Ä∫', price:1500},
        {id:4, name:'·Ä°·Äû·Ä¨·Ä∏·ÄÅ·Äª·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏(·ÄÄ·Äº·ÄÄ·Ä∫)', price:800}, {id:5, name:'·Ä°·Äõ·Ä±·ÄÅ·ÄΩ·Ä∂', price:500}, {id:6, name:'·Ä°·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Äï·Äª·Ä∂', price:500},
        {id:7, name:'·Ä°·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Äï·Äª·Ä∂(CP)', price:1000}, {id:8, name:'·Ä°·Ä∞', price:500}, {id:9, name:'·ÄÅ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏', price:300},
        {id:10, name:'·Äú·Ää·Ä∫·ÄÅ·Äª·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏', price:300}, {id:11, name:'·Ä°·Äû·Ää·Ä∫·Ä∏·Äô·Äº·ÄÖ·Ä∫', price:500}, {id:12, name:'·ÄÅ·Äº·Ä±·Äë·Ä±·Ä¨·ÄÄ·Ä∫', price:300},
        {id:13, name:'·ÄÅ·Äº·Ä±·Äë·Ä±·Ä¨·ÄÄ·Ä∫(CP)', price:700}, {id:14, name:'·Äú·ÄÄ·Ä∫·Äô·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äú·ÄØ·Ä∂·Ä∏', price:1000}, {id:15, name:'·Ä°·ÄÜ·ÄÆ·Äï·Ä∞·Ä∏', price:800},
        {id:16, name:'·Ä°·Äû·Ä¨·Ä∏·Äê·ÄØ', price:400}, {id:17, name:'·Äõ·ÄØ·Ä∂·Ä∏·Äï·Äê·Ä±·Äû·ÄÆ·Ä∏', price:300}, {id:18, name:'·Ä°·Äï·Ä∫·Äô·Äæ·Ä≠·ÄØ', price:1000}, {id:19, name:'·ÄÑ·ÄØ·Ä∂·Ä∏·Ä•', price:1000}
    ];

    let cart = {};

    function showTab(tab) {
        document.querySelectorAll('.content').forEach(c => c.classList.add('hidden'));
        document.querySelectorAll('.nav-tabs button').forEach(b => b.classList.remove('active'));
        document.getElementById('sec-' + tab).classList.remove('hidden');
        document.getElementById('tab-' + tab)?.classList.add('active');
        document.getElementById('cart-footer').classList.toggle('hidden', tab !== 'shop');
    }

    function renderShop() {
        document.getElementById('item-list').innerHTML = menu.map(item => `
            <div class="item-card">
                <div><b>${item.name}</b><br><span class="price">${item.price} K</span></div>
                <div style="display:flex; align-items:center; gap:10px;">
                    <button class="qty-btn" onclick="updateQty('${item.name}', -1)">-</button>
                    <b id="q-${item.name}">0</b>
                    <button class="qty-btn" onclick="updateQty('${item.name}', 1)">+</button>
                </div>
            </div>
        `).join('');
    }

    function updateQty(name, change) {
        cart[name] = (cart[name] || 0) + change;
        if(cart[name] < 0) cart[name] = 0;
        document.getElementById('q-'+name).innerText = cart[name];
        let total = 0;
        for(let k in cart) total += (cart[k] * menu.find(m => m.name === k).price);
        document.getElementById('total-val').innerText = total.toLocaleString();
    }

    function goToPay() {
        if(!document.getElementById('cust_name').value || document.getElementById('total-val').innerText == "0") {
            return alert("·Ä°·Äô·Ää·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏ ·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´·Åã");
        }
        let itemsHtml = "<b>Items:</b><br>";
        for(let k in cart) if(cart[k] > 0) itemsHtml += `- ${k} (${cart[k]} ·ÄÅ·ÄØ)<br>`;
        document.getElementById('voucher-summary').innerHTML = `
            <div style="text-align:center; font-weight:bold; border-bottom:1px solid #ddd; padding-bottom:5px; margin-bottom:10px;">Order Summary</div>
            <div class="detail-line"><span>Customer:</span> <b>${document.getElementById('cust_name').value}</b></div>
            <div style="font-size:13px; margin:10px 0;">${itemsHtml}</div>
            <div class="detail-line" style="font-size:16px; border-top:1px solid #ddd; padding-top:5px;"><span>Total:</span> <b class="price">${document.getElementById('total-val').innerText} K</b></div>
        `;
        showTab('pay');
        document.getElementById('cart-footer').classList.add('hidden');
    }

    async function submitFinalOrder() {
        const btn = document.querySelector('.btn-amazon');
        btn.disabled = true; btn.innerText = "Submitting...";

        const file = document.getElementById('pay_file').files[0];
        let imgUrl = "";
        if(file) {
            const fName = Date.now() + "_" + file.name;
            const { data } = await _supabase.storage.from('payment-proofs').upload(fName, file);
            if(data) imgUrl = SB_URL + "/storage/v1/object/public/payment-proofs/" + fName;
        }

        const orderObj = {
            customer_name: document.getElementById('cust_name').value,
            phone: document.getElementById('cust_phone').value,
            items: Object.keys(cart).filter(k => cart[k] > 0).map(k => `${k}(${cart[k]})`).join(", "),
            total: parseInt(document.getElementById('total-val').innerText.replace(/,/g, '')),
            transaction_id: document.getElementById('pay_txid').value,
            payment_image: imgUrl
        };

        const { data: res, error } = await _supabase.from('orders').insert([orderObj]).select();

        if(!error) {
            const msg = `üîî *·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Ä°·Äû·ÄÖ·Ä∫*%0A------------------%0AID: #${res[0].id}%0Aüë§ ·Äù·Äö·Ä∫·Äû·Ä∞: ${orderObj.customer_name}%0Aüìû ·Äñ·ÄØ·Äî·Ä∫·Ä∏: ${orderObj.phone}%0Aüì¶ *·Äô·Äæ·Ä¨·Äö·Ä∞·Äû·Ää·Ä∑·Ä∫·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏:*%0A${orderObj.items}%0Aüí∞ ·ÄÖ·ÄØ·ÄÖ·ÄØ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏: ${orderObj.total} K%0Aüîë TXID: ${orderObj.transaction_id}`;
            fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage?chat_id=${TG_CHAT_ID}&text=${msg}&parse_mode=Markdown`);
            alert("Order Success! Telegram ·ÄÜ·ÄÆ·Äû·Ä≠·ÄØ·Ä∑ ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äï·Ä≠·ÄØ·Ä∑·Äë·Ä¨·Ä∏·Äï·Ä´·Äû·Ää·Ä∫·Åã");
            location.reload();
        }
    }

    async function adminLogin() {
        if(document.getElementById('adm-pass').value === "2012@Yewin") {
            document.getElementById('admin-auth').classList.add('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
            const { data: ords } = await _supabase.from('orders').select('*').order('id', {descending:true});
            document.getElementById('adm-total').innerText = ords.reduce((a,b)=> a+b.total, 0).toLocaleString();
            document.getElementById('adm-count').innerText = ords.length;
            document.getElementById('adm-order-list').innerHTML = ords.map(o => `
                <div class="order-card">
                    <div class="detail-line"><b>#${o.id} - ${o.customer_name}</b> <span>${new Date(o.created_at).toLocaleTimeString()}</span></div>
                    <div style="color:#B12704; font-size:13px; margin:5px 0;">${o.items}</div>
                    <div class="detail-line"><span>Phone: ${o.phone}</span> <b>${o.total} K</b></div>
                    <div class="detail-line"><small>TXID: ${o.transaction_id || 'N/A'}</small> ${o.payment_image ? `<a href="${o.payment_image}" target="_blank">View Photo</a>` : ''}</div>
                </div>
            `).join('');
        }
    }

    renderShop();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ— MYINTHAR BBQ - Premium POS</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --premium-dark: #0f172a; 
            --premium-blue: #1e293b; 
            --gold: #fbbf24; 
            --soft-white: #f8fafc;
            --accent: #38bdf8;
            --danger: #ef4444;
        }
        body { font-family: 'Pyidaungsu', sans-serif; background: var(--premium-dark); margin: 0; color: var(--soft-white); }
        .container { max-width: 500px; margin: auto; background: var(--premium-blue); min-height: 100vh; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        
        /* Header & Premium UI */
        header { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 25px 15px; text-align: center; border-bottom: 2px solid var(--gold); }
        .logo-text { font-size: 22px; font-weight: bold; color: var(--gold); letter-spacing: 1px; }
        .shop-status-tag { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; margin-top: 10px; font-weight: bold; }
        .status-open { background: #10b981; color: white; }
        .status-closed { background: var(--danger); color: white; }

        .nav-tabs { display: flex; background: #334155; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #475569; }
        .nav-tabs button { flex: 1; padding: 15px; border: none; background: none; color: #94a3b8; cursor: pointer; transition: 0.3s; font-family: 'Pyidaungsu'; font-size: 14px; }
        .nav-tabs button.active { color: var(--gold); border-bottom: 3px solid var(--gold); background: rgba(251, 191, 36, 0.1); }

        .content { padding: 20px; padding-bottom: 150px; }
        .hidden { display: none !important; }
        .card { background: #334155; border: 1px solid #475569; border-radius: 12px; padding: 15px; margin-bottom: 15px; }

        /* Item Rows */
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #475569; }
        .price-text { color: var(--gold); font-weight: bold; font-size: 16px; }
        .qty-control { display: flex; align-items: center; gap: 12px; }
        .btn-qty { width: 35px; height: 35px; border: none; background: #475569; color: white; border-radius: 8px; cursor: pointer; font-size: 18px; }
        .btn-qty:hover { background: var(--gold); color: black; }

        /* Buttons & Inputs */
        .btn-premium { background: var(--gold); color: black; border: none; border-radius: 12px; width: 100%; padding: 16px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.3s; }
        .btn-premium:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(251, 191, 36, 0.4); }
        .btn-premium:disabled { background: #64748b; cursor: not-allowed; }
        
        input { width: 100%; padding: 12px; margin: 8px 0; background: #1e293b; border: 1px solid #475569; border-radius: 8px; color: white; box-sizing: border-box; }
        input:focus { border-color: var(--gold); outline: none; }

        /* Admin Special UI */
        .switch-box { display: flex; justify-content: space-between; align-items: center; background: #1e293b; padding: 15px; border-radius: 12px; border: 1px solid var(--gold); }
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: bold; }
        .footer-fixed { position: fixed; bottom: 0; max-width: 500px; width: 100%; background: #1e293b; border-top: 1px solid #475569; padding: 20px; box-sizing: border-box; border-radius: 20px 20px 0 0; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="logo-text">MYINTHAR BBQ PREMIUM</div>
        <div id="shop-badge" class="shop-status-tag status-open">á€†á€­á€¯á€„á€ºá€–á€½á€„á€·á€ºá€‘á€¬á€¸á€á€Šá€º</div>
    </header>

    <div class="nav-tabs">
        <button id="t-shop" class="active" onclick="showTab('shop')">á€¡á€›á€±á€¬á€„á€ºá€¸á€á€”á€ºá€¸</button>
        <button id="t-orders" onclick="showTab('orders')">á€¡á€±á€¬á€ºá€’á€«á€…á€…á€ºá€›á€”á€º</button>
        <button id="t-admin" onclick="showTab('admin')">ADMIN</button>
    </div>

    <div id="sec-shop" class="content">
        <div id="closed-screen" class="hidden" style="text-align:center; padding: 50px 20px;">
            <div style="font-size: 60px;">ğŸŒ™</div>
            <h3>á€šá€á€¯ á€†á€­á€¯á€„á€ºá€•á€­á€á€ºá€‘á€¬á€¸á€•á€«á€á€Šá€º</h3>
            <p style="color: #94a3b8;">á€™á€€á€¼á€¬á€á€„á€º á€•á€¼á€”á€ºá€œá€Šá€ºá€–á€½á€„á€·á€ºá€œá€¾á€…á€ºá€•á€«á€á€±á€¬á€·á€™á€Šá€ºá‹</p>
        </div>
        <div id="shop-content">
            <div class="card">
                <input type="text" id="c_name" placeholder="ğŸ‘¤ á€á€šá€ºá€šá€°á€á€°á€¡á€™á€Šá€º">
                <input type="tel" id="c_phone" placeholder="ğŸ“ á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º">
            </div>
            <div id="menu-list"></div>
        </div>
    </div>

    <div id="sec-admin" class="content hidden">
        <div id="admin-auth">
            <h3 style="text-align:center;">Admin Access</h3>
            <input type="password" id="admin-pass" placeholder="Password">
            <button class="btn-premium" onclick="loginAdmin()">á€á€„á€ºá€™á€Šá€º</button>
        </div>
        <div id="admin-panel" class="hidden">
            <div class="switch-box">
                <span>á€†á€­á€¯á€„á€ºá€–á€½á€„á€·á€º/á€•á€­á€á€º á€‘á€­á€”á€ºá€¸á€á€»á€¯á€•á€ºá€›á€”á€º</span>
                <button id="master-switch" onclick="toggleShop()" class="badge status-open" style="border:none; cursor:pointer; padding:10px;">OPEN</button>
            </div>
            
            <div class="card" style="margin-top:20px; background:linear-gradient(to right, #1e293b, #334155);">
                <small>á€šá€”á€±á€·á€›á€±á€¬á€„á€ºá€¸á€›á€„á€½á€± (á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€¼á€®á€¸)</small>
                <h2 id="adm-sales" style="color:var(--gold); margin:5px 0;">0 K</h2>
            </div>

            <div id="adm-list-area"><h4>á€¡á€±á€¬á€ºá€’á€«á€…á€¬á€›á€„á€ºá€¸</h4><div id="adm-orders"></div></div>
        </div>
    </div>

    <div id="sec-orders" class="content hidden">
        <input type="tel" id="track-phone" placeholder="á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€ºá€–á€¼á€„á€·á€º á€¡á€±á€¬á€ºá€’á€«á€›á€¾á€¬á€›á€”á€º" oninput="fetchHistory()">
        <div id="history-list"></div>
    </div>

    <div id="footer-cart" class="footer-fixed">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-weight:bold;">
            <span>á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸:</span>
            <span id="total-val" style="color:var(--gold); font-size:20px;">0 K</span>
        </div>
        <button id="checkout-btn" class="btn-premium" onclick="goToCheckout()">á€¡á€±á€¬á€ºá€’á€«á€á€„á€ºá€™á€Šá€º</button>
    </div>
</div>

<script>
    const SB_URL = "https://ltusknkpwbyriikeyday.supabase.co";
    const SB_KEY = "sb_publishable_u9Y8SIpzqsT4WkyONV4J2w__Xwc09Fv";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);
    const TG_TOKEN = "8215695761:AAF1qDjAJn7gjiHyzf8t7W6c8e51cim98sU";
    const TG_CHAT_ID = "8116152317";
    const alarm = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

    let menu = [
        {name:'á€€á€¼á€€á€ºá€•á€±á€«á€„á€º', price:4000}, {name:'á€€á€¼á€€á€ºá€›á€„á€ºá€¡á€¯á€¶', price:4000}, {name:'á€†á€­á€á€ºá€á€¬á€¸á€€á€„á€º', price:1500},
        {name:'á€¡á€á€¬á€¸á€á€»á€±á€¬á€„á€ºá€¸', price:800}, {name:'á€¡á€›á€±á€á€½á€¶', price:500}, {name:'á€¡á€á€±á€¬á€„á€ºá€•á€»á€¶', price:500},
        {name:'á€¡á€á€±á€¬á€„á€ºá€•á€»á€¶(CP)', price:1000}, {name:'á€¡á€°', price:500}, {name:'á€á€±á€«á€„á€ºá€¸', price:300}
    ];

    let cart = {};
    let isShopOpen = true;

    function showTab(t) {
        document.querySelectorAll('.content').forEach(c => c.classList.add('hidden'));
        document.querySelectorAll('.nav-tabs button').forEach(b => b.classList.remove('active'));
        document.getElementById('sec-'+t).classList.remove('hidden');
        document.getElementById('t-'+t).classList.add('active');
        document.getElementById('footer-cart').classList.toggle('hidden', t !== 'shop');
        updateUI();
    }

    function toggleShop() {
        isShopOpen = !isShopOpen;
        updateUI();
        alert("á€†á€­á€¯á€„á€ºá€€á€­á€¯ " + (isShopOpen ? "á€–á€½á€„á€·á€º" : "á€•á€­á€á€º") + " á€œá€­á€¯á€€á€ºá€•á€«á€•á€¼á€®á‹");
    }

    function updateUI() {
        const badge = document.getElementById('shop-badge');
        const switchBtn = document.getElementById('master-switch');
        const shopContent = document.getElementById('shop-content');
        const closedScreen = document.getElementById('closed-screen');
        const checkoutBtn = document.getElementById('checkout-btn');

        if(isShopOpen) {
            badge.innerText = "á€†á€­á€¯á€„á€ºá€–á€½á€„á€·á€ºá€‘á€¬á€¸á€á€Šá€º"; badge.className = "shop-status-tag status-open";
            switchBtn.innerText = "OPEN"; switchBtn.className = "badge status-open";
            shopContent.classList.remove('hidden'); closedScreen.classList.add('hidden');
            checkoutBtn.disabled = false;
        } else {
            badge.innerText = "á€†á€­á€¯á€„á€ºá€•á€­á€á€ºá€‘á€¬á€¸á€á€Šá€º"; badge.className = "shop-status-tag status-closed";
            switchBtn.innerText = "CLOSED"; switchBtn.className = "badge status-closed";
            shopContent.classList.add('hidden'); closedScreen.classList.remove('hidden');
            checkoutBtn.disabled = true;
        }
    }

    function renderShop() {
        document.getElementById('menu-list').innerHTML = menu.map(i => `
            <div class="item-row">
                <div><b>${i.name}</b><br><span class="price-text">${i.price} K</span></div>
                <div class="qty-control">
                    <button class="btn-qty" onclick="updateQty('${i.name}', -1)">âˆ’</button>
                    <b id="q-${i.name}">0</b>
                    <button class="btn-qty" onclick="updateQty('${i.name}', 1)">+</button>
                </div>
            </div>
        `).join('');
    }

    function updateQty(n, c) {
        cart[n] = (cart[n] || 0) + c; if(cart[n] < 0) cart[n] = 0;
        document.getElementById('q-'+n).innerText = cart[n];
        let total = 0;
        for(let k in cart) total += (cart[k] * menu.find(m => m.name === k).price);
        document.getElementById('total-val').innerText = total.toLocaleString() + " K";
    }

    async function goToCheckout() {
        if(!document.getElementById('c_name').value || document.getElementById('total-val').innerText === "0 K") return alert("á€¡á€™á€Šá€ºá€”á€¾á€„á€·á€º á€•á€…á€¹á€…á€Šá€ºá€¸á€›á€½á€±á€¸á€•á€«á‹");
        const order = { 
            customer_name: document.getElementById('c_name').value, 
            phone: document.getElementById('c_phone').value, 
            items: Object.keys(cart).filter(k=>cart[k]>0).map(k=>`${k}(${cart[k]})`).join(", "), 
            total: parseInt(document.getElementById('total-val').innerText.replace(/,/g,'')) 
        };
        const { data, error } = await _supabase.from('orders').insert([order]).select();
        if(!error) {
            fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage?chat_id=${TG_CHAT_ID}&text=ğŸ”” *á€¡á€±á€¬á€ºá€’á€«á€¡á€á€…á€º*%0AID: #${data[0].id}%0AğŸ‘¤ á€á€šá€ºá€á€°: ${order.customer_name}%0AğŸ“¦ á€…á€¬á€›á€„á€ºá€¸: ${order.items}%0AğŸ’° Total: ${order.total} K&parse_mode=Markdown`);
            alert("á€¡á€±á€¬á€ºá€’á€«á€á€„á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹"); location.reload();
        }
    }

    async function fetchHistory() {
        const p = document.getElementById('track-phone').value; if(p.length < 7) return;
        const { data } = await _supabase.from('orders').select('*').eq('phone', p).order('id', {descending:true});
        document.getElementById('history-list').innerHTML = data.map(o => `<div class="card" style="border-left: 4px solid var(--gold);"><span class="badge ${o.status==='á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€¼á€®á€¸'?'status-open':'status-closed'}" style="float:right">${o.status}</span><b>#${o.id}</b><br><small>${o.items}</small><br><b style="color:var(--gold)">${o.total.toLocaleString()} K</b></div>`).join('');
    }

    function loginAdmin() {
        if(document.getElementById('admin-pass').value === "2012@Yewin") {
            document.getElementById('admin-auth').classList.add('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
            refreshAdmin(); setInterval(refreshAdmin, 10000);
        }
    }

    async function refreshAdmin() {
        const { data } = await _supabase.from('orders').select('*').order('id', {descending:true});
        document.getElementById('adm-sales').innerText = data.filter(o=>o.status==='á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€¼á€®á€¸').reduce((a,b)=>a+b.total, 0).toLocaleString() + " K";
        document.getElementById('adm-orders').innerHTML = data.map(o => `
            <div class="card">
                <b>#${o.id} - ${o.customer_name}</b><br><small style="color:var(--gold)">${o.items}</small><br>
                <b>${o.total.toLocaleString()} K</b> | ${o.phone}<br>
                <button onclick="approveOrder(${o.id})" class="btn-premium" style="padding:8px; margin-top:10px; font-size:12px;">á€¡á€á€Šá€ºá€•á€¼á€¯á€™á€Šá€º</button>
            </div>
        `).join('');
    }

    async function approveOrder(id) {
        await _supabase.from('orders').update({ status: 'á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€¼á€®á€¸' }).eq('id', id);
        refreshAdmin();
    }

    window.onload = renderShop;
</script>
</body>
</html>


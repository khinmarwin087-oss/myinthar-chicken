<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçó MYINTHAR BBQ PREMIUM POS</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --premium-dark: #0f172a; --premium-blue: #1e293b; --gold: #fbbf24; --soft-white: #f8fafc; --danger: #ef4444; }
        body { font-family: 'Pyidaungsu', sans-serif; background: var(--premium-dark); margin: 0; color: var(--soft-white); }
        .container { max-width: 500px; margin: auto; background: var(--premium-blue); min-height: 100vh; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        header { background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%); padding: 25px 15px; text-align: center; border-bottom: 2px solid var(--gold); }
        .nav-tabs { display: flex; background: #334155; position: sticky; top: 0; z-index: 100; }
        .nav-tabs button { flex: 1; padding: 15px; border: none; background: none; color: #94a3b8; cursor: pointer; font-family: 'Pyidaungsu'; font-size: 14px; }
        .nav-tabs button.active { color: var(--gold); border-bottom: 3px solid var(--gold); background: rgba(251, 191, 36, 0.1); }
        .content { padding: 20px; padding-bottom: 160px; }
        .hidden { display: none !important; }
        .card { background: #334155; border: 1px solid #475569; border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #475569; }
        .btn-qty { width: 35px; height: 35px; border: none; background: #475569; color: white; border-radius: 8px; font-size: 20px; cursor: pointer; }
        .btn-premium { background: var(--gold); color: black; border: none; border-radius: 12px; width: 100%; padding: 16px; font-weight: bold; cursor: pointer; }
        input { width: 100%; padding: 12px; margin: 8px 0; background: #1e293b; border: 1px solid #475569; border-radius: 8px; color: white; box-sizing: border-box; }
        .voucher { border: 1px solid #000; padding: 15px; background: #fff; color: #000; font-family: monospace; }
        .footer-fixed { position: fixed; bottom: 0; max-width: 500px; width: 100%; background: #1e293b; padding: 20px; box-sizing: border-box; border-radius: 20px 20px 0 0; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div style="font-size:22px; color:var(--gold); font-weight:bold;">MYINTHAR BBQ PREMIUM</div>
        <div id="shop-badge" style="font-size:12px; margin-top:5px; color:#10b981;">‚óè ·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äë·Ä¨·Ä∏·Äû·Ää·Ä∫</div>
    </header>

    <div class="nav-tabs">
        <button id="t-shop" class="active" onclick="showTab('shop')">·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Äô·Äæ·Ä¨·Äõ·Äî·Ä∫</button>
        <button id="t-orders" onclick="showTab('orders')">·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·ÄÖ·ÄÖ·Ä∫·Äõ·Äî·Ä∫</button>
        <button id="t-admin" onclick="showTab('admin')">ADMIN</button>
    </div>

    <div id="sec-shop" class="content">
        <div id="closed-screen" class="hidden" style="text-align:center; padding: 50px 0;"><h2>‚ùå ·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä≠·Äê·Ä∫·Äë·Ä¨·Ä∏·Äï·Ä´·Äû·Ää·Ä∫</h2></div>
        <div id="shop-main">
            <div class="card"><input type="text" id="c_name" placeholder="üë§ ·Äù·Äö·Ä∫·Äö·Ä∞·Äû·Ä∞·Ä°·Äô·Ää·Ä∫"><input type="tel" id="c_phone" placeholder="üìû ·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫"></div>
            <div id="menu-list"></div>
        </div>
    </div>

    <div id="sec-checkout" class="content hidden">
        <div class="voucher" id="voucher-ui">
            <h3 style="text-align:center;">MYINTHAR BBQ</h3>
            <p id="v-time" style="font-size:11px; text-align:center;"></p>
            <div id="v-items"></div>
            <hr><div style="text-align:right;"><b>Total: <span id="v-total"></span> K</b></div>
        </div>
        <div class="card" style="margin-top:15px; text-align:center; background:#fff9f0; color:#000;">
            <p><b>Pay: 09767287345 (KPay/AYA)</b></p>
            <a href="tel:09767287345" style="color:green; font-weight:bold;">üìû ·Äñ·ÄØ·Äî·Ä∫·Ä∏·ÄÅ·Ä±·Ä´·Ä∫·ÄÜ·Ä≠·ÄØ·Åç ·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äõ·Äî·Ä∫</a>
        </div>
        <button class="btn-premium" onclick="submitOrder()">·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äï·Äº·ÄÆ·Ä∏ ·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Äê·ÄÑ·Ä∫·Äô·Ää·Ä∫</button>
    </div>

    <div id="sec-admin" class="content hidden">
        <div id="admin-auth"><input type="password" id="admin-pass" placeholder="Password"><button class="btn-premium" onclick="loginAdmin()">Login</button></div>
        <div id="admin-panel" class="hidden">
            <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                <span>·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫ ·Ä°·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫/·Ä°·Äï·Ä≠·Äê·Ä∫</span>
                <button id="shop-switch" onclick="toggleShop()" style="padding:8px; border-radius:8px; border:none; background:var(--gold); font-weight:bold;">OPEN</button>
            </div>
            <div class="card" style="text-align:center;">
                <small>·Äö·Äî·Ä±·Ä∑·Äõ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äõ·ÄÑ·ÄΩ·Ä±</small><h2 id="adm-sales" style="color:var(--gold); margin:5px;">0 K</h2>
            </div>
            <div id="adm-list"></div>
        </div>
    </div>

    <div id="sec-orders" class="content hidden">
        <input type="tel" id="track-phone" placeholder="·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Äõ·Äæ·Ä¨·Äï·Ä´" oninput="fetchHistory()">
        <div id="history-display"></div>
    </div>

    <div id="footer-cart" class="footer-fixed">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;"><b>Total:</b> <span id="total-val" style="color:var(--gold); font-size:20px;">0 K</span></div>
        <button class="btn-premium" onclick="goToCheckout()">CHECKOUT</button>
    </div>
</div>

<script>
    const SB_URL = "https://ltusknkpwbyriikeyday.supabase.co";
    const SB_KEY = "sb_publishable_u9Y8SIpzqsT4WkyONV4J2w__Xwc09Fv";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);
    const TG_TOKEN = "8215695761:AAF1qDjAJn7gjiHyzf8t7W6c8e51cim98sU";
    const TG_CHAT_ID = "8116152317";
    const alarm = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

    let menu = [
        {name:'·ÄÄ·Äº·ÄÄ·Ä∫·Äï·Ä±·Ä´·ÄÑ·Ä∫', price:4000}, {name:'·ÄÄ·Äº·ÄÄ·Ä∫·Äõ·ÄÑ·Ä∫·Ä°·ÄØ·Ä∂', price:4000}, {name:'·ÄÜ·Ä≠·Äê·Ä∫·Äû·Ä¨·Ä∏·ÄÄ·ÄÑ·Ä∫', price:1500},
        {name:'·Ä°·Äû·Ä¨·Ä∏·ÄÅ·Äª·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏(·ÄÄ·Äº·ÄÄ·Ä∫)', price:800}, {name:'·Ä°·Äõ·Ä±·ÄÅ·ÄΩ·Ä∂', price:500}, {name:'·Ä°·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Äï·Äª·Ä∂', price:500},
        {name:'·Ä°·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Äï·Äª·Ä∂(CP)', price:1000}, {name:'·Ä°·Ä∞', price:500}, {name:'·ÄÅ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏', price:300},
        {name:'·Äú·Ää·Ä∫·ÄÅ·Äª·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏', price:300}, {name:'·Ä°·Äû·Ää·Ä∫·Ä∏·Äô·Äº·ÄÖ·Ä∫', price:500}, {name:'·ÄÅ·Äº·Ä±·Äë·Ä±·Ä¨·ÄÄ·Ä∫', price:300},
        {name:'·ÄÅ·Äº·Ä±·Äë·Ä±·Ä¨·ÄÄ·Ä∫(CP)', price:700}, {name:'·Äú·ÄÄ·Ä∫·Äô·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äú·ÄØ·Ä∂·Ä∏', price:1000}, {name:'·Ä°·ÄÜ·ÄÆ·Äï·Ä∞·Ä∏', price:800},
        {name:'·Ä°·Äû·Ä¨·Ä∏·Äê·ÄØ', price:400}, {name:'·Äõ·ÄØ·Ä∂·Ä∏·Äï·Äê·Ä±·Äû·ÄÆ·Ä∏', price:300}, {name:'·Ä°·Äï·Ä∫·Äô·Äæ·Ä≠·ÄØ', price:1000}, {name:'·ÄÑ·ÄØ·Ä∂·Ä∏·Ä•', price:1000}
    ];

    let cart = {}; let isShopOpen = true; let lastCount = 0;

    function showTab(t) {
        document.querySelectorAll('.content').forEach(c => c.classList.add('hidden'));
        document.querySelectorAll('.nav-tabs button').forEach(b => b.classList.remove('active'));
        document.getElementById('sec-'+t).classList.remove('hidden');
        document.getElementById('t-'+t).classList.add('active');
        document.getElementById('footer-cart').classList.toggle('hidden', t !== 'shop');
    }

    function toggleShop() {
        isShopOpen = !isShopOpen;
        document.getElementById('shop-badge').innerText = isShopOpen ? "‚óè ·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äë·Ä¨·Ä∏·Äû·Ää·Ä∫" : "‚óã ·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä≠·Äê·Ä∫·Äë·Ä¨·Ä∏·Äû·Ää·Ä∫";
        document.getElementById('shop-badge').style.color = isShopOpen ? "#10b981" : "var(--danger)";
        document.getElementById('shop-main').classList.toggle('hidden', !isShopOpen);
        document.getElementById('closed-screen').classList.toggle('hidden', isShopOpen);
        document.getElementById('shop-switch').innerText = isShopOpen ? "OPEN" : "CLOSED";
    }

    function renderShop() {
        document.getElementById('menu-list').innerHTML = menu.map(i => `
            <div class="item-row">
                <div><b>${i.name}</b><br><small style="color:var(--gold)">${i.price} K</small></div>
                <div style="display:flex; align-items:center; gap:10px;">
                    <button class="btn-qty" onclick="updateQty('${i.name}', -1)">‚àí</button>
                    <b id="q-${i.name}">0</b>
                    <button class="btn-qty" onclick="updateQty('${i.name}', 1)">+</button>
                </div>
            </div>
        `).join('');
    }

    function updateQty(n, c) {
        cart[n] = (cart[n] || 0) + c; if(cart[n] < 0) cart[n] = 0;
        document.getElementById('q-'+n).innerText = cart[n];
        let total = 0; for(let k in cart) total += (cart[k] * menu.find(m => m.name === k).price);
        document.getElementById('total-val').innerText = total.toLocaleString() + " K";
    }

    function goToCheckout() {
        if(!document.getElementById('c_name').value || document.getElementById('total-val').innerText == "0 K") return alert("·Ä°·Äô·Ää·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´·Åã");
        let itemsHtml = ""; for(let k in cart) if(cart[k] > 0) itemsHtml += `<div style="display:flex; justify-content:space-between; font-size:12px;"><span>${k} x ${cart[k]}</span><span>${(cart[k]*menu.find(m=>m.name===k).price).toLocaleString()}</span></div>`;
        document.getElementById('v-time').innerText = new Date().toLocaleString();
        document.getElementById('v-items').innerHTML = itemsHtml;
        document.getElementById('v-total').innerText = document.getElementById('total-val').innerText;
        showTab('checkout'); document.getElementById('footer-cart').classList.add('hidden');
    }

    async function submitOrder() {
        const order = { customer_name: document.getElementById('c_name').value, phone: document.getElementById('c_phone').value, items: Object.keys(cart).filter(k=>cart[k]>0).map(k=>`${k}(${cart[k]})`).join(", "), total: parseInt(document.getElementById('total-val').innerText.replace(/,/g,'')) };
        const { data, error } = await _supabase.from('orders').insert([order]).select();
        if(!error) {
            fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage?chat_id=${TG_CHAT_ID}&text=üîî *·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Äû·ÄÖ·Ä∫*%0AID: #${data[0].id}%0Aüë§ ·Äù·Äö·Ä∫·Äû·Ä∞: ${order.customer_name}%0Aüì¶ ·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏: ${order.items}%0Aüí∞ ·ÄÖ·ÄØ·ÄÖ·ÄØ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏: ${order.total} K&parse_mode=Markdown`);
            alert("·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Äê·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã"); location.reload();
        } else { alert("Error: " + error.message); }
    }

    function loginAdmin() {
        if(document.getElementById('admin-pass').value === "2012@Yewin") {
            document.getElementById('admin-auth').classList.add('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
            refreshAdmin(); setInterval(refreshAdmin, 10000);
        }
    }

    async function refreshAdmin() {
        const { data } = await _supabase.from('orders').select('*').order('id', {descending:true});
        if(data.length > lastCount && lastCount !== 0) { alarm.play(); }
        lastCount = data.length;
        document.getElementById('adm-sales').innerText = data.filter(o=>o.status==='·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äï·Äº·ÄÆ·Ä∏').reduce((a,b)=>a+b.total, 0).toLocaleString() + " K";
        document.getElementById('adm-list').innerHTML = data.map(o => `
            <div class="card" style="font-size:12px;">
                <b>#${o.id} - ${o.customer_name}</b> (${o.phone})<br>
                <small style="color:var(--gold);">${o.items}</small><br>
                <b>${o.total.toLocaleString()} K</b> | ${new Date(o.created_at).toLocaleTimeString()}<br>
                <button onclick="approveOrder(${o.id})" style="background:#10b981; color:white; border:none; padding:8px; width:100%; border-radius:4px; margin-top:5px; cursor:pointer;">·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äô·Ää·Ä∫</button>
            </div>
        `).join('');
    }

    async function approveOrder(id) { await _supabase.from('orders').update({ status: '·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·Äï·Äº·ÄÆ·Ä∏' }).eq('id', id); refreshAdmin(); }
    async function fetchHistory() {
        const p = document.getElementById('track-phone').value; if(p.length < 7) return;
        const { data } = await _supabase.from('orders').select('*').eq('phone', p).order('id', {descending:true});
        document.getElementById('history-display').innerHTML = data.map(o => `<div class="card"><b>#${o.id}</b> - ${o.status}<br><small>${o.items}</small><br><b>${o.total.toLocaleString()} K</b></div>`).join('');
    }

    window.onload = renderShop;
</script>
</body>
</html>


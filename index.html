<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.M.W Jewelry - Professional Wholesale</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #FF4747; --dark: #191919; --bg: #F0F2F5; }
        body { font-family: 'Plus Jakarta Sans', 'Pyidaungsu', sans-serif; background: var(--bg); margin: 0; }
        
        /* Header & Cart Badge */
        .top-nav { background: white; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 2000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .cart-icon { position: relative; cursor: pointer; font-size: 24px; }
        .cart-badge { position: absolute; top: -5px; right: -8px; background: var(--primary); color: white; font-size: 10px; padding: 2px 6px; border-radius: 50%; font-weight: 800; }

        /* Main Display */
        .promo-banner { margin: 15px; height: 140px; background: linear-gradient(135deg, #FF4747, #FF8E05); border-radius: 20px; color: white; display: flex; align-items: center; padding: 20px; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px; }
        .card { background: white; border-radius: 16px; overflow: hidden; cursor: pointer; transition: 0.3s; }
        .card:hover { transform: translateY(-5px); }
        .card img { width: 100%; height: 160px; object-fit: cover; }

        /* Product Detail Modal (Pop-up) */
        #product-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 3000; align-items: flex-end; }
        .modal-content { background: white; width: 100%; max-width: 500px; margin: auto; border-radius: 30px 30px 0 0; padding: 25px; position: relative; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .modal-img { width: 100%; height: 250px; object-fit: cover; border-radius: 20px; }
        .qty-input { display: flex; align-items: center; gap: 15px; margin: 15px 0; }
        .btn-qty { width: 35px; height: 35px; border-radius: 50%; border: 1px solid #ddd; background: white; font-size: 20px; cursor: pointer; }

        /* Cart Drawer (Side Menu) */
        #cart-drawer { position: fixed; right: -100%; top: 0; width: 85%; max-width: 400px; height: 100%; background: white; z-index: 4000; transition: 0.4s; padding: 25px; box-sizing: border-box; box-shadow: -10px 0 30px rgba(0,0,0,0.1); }
        #cart-drawer.open { right: 0; }
        .cart-item { display: flex; gap: 10px; padding: 10px 0; border-bottom: 1px solid #eee; }

        .btn-add-cart { background: var(--dark); color: white; width: 100%; padding: 15px; border-radius: 15px; font-weight: 800; border: none; cursor: pointer; margin-top: 10px; }
        .btn-checkout { background: var(--primary); color: white; width: 100%; padding: 15px; border-radius: 15px; font-weight: 800; border: none; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>

<div class="top-nav">
    <div style="font-weight:800; color:var(--primary); font-size:22px;">K.M.W</div>
    <div class="cart-icon" onclick="toggleCart()">
        ðŸ›’ <span class="cart-badge" id="cart-count">0</span>
    </div>
</div>

<div class="promo-banner">
    <h2>Jewelry New Arrivals</h2>
</div>

<div id="menu-display" class="menu-grid">Loading...</div>

<div id="product-modal">
    <div class="modal-content" id="modal-data">
        </div>
</div>

<div id="cart-drawer">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 style="margin:0;">Shopping Cart</h2>
        <span onclick="toggleCart()" style="cursor:pointer; font-size:24px;">Ã—</span>
    </div>
    <div id="cart-list" style="margin-top:20px; height:70%; overflow-y:auto;"></div>
    <div style="border-top:2px solid #eee; padding-top:15px;">
        <div style="display:flex; justify-content:space-between;">
            <b>Total:</b>
            <b id="cart-total" style="color:var(--primary); font-size:20px;">0 K</b>
        </div>
        <button class="btn-checkout" onclick="checkout()">Check Out âž”</button>
    </div>
</div>

<script>
    const SB_URL = "https://ltusknkpwbyriikeyday.supabase.co";
    const SB_KEY = "YOUR_SUPABASE_KEY";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

    let allItems = [];
    let cart = [];
    let selectedItem = null;

    async function loadMenu() {
        const { data } = await _supabase.from('menu_items').select('*');
        allItems = data;
        renderMenu(data);
    }

    function renderMenu(items) {
        document.getElementById('menu-display').innerHTML = items.map(item => `
            <div class="card" onclick="openProduct('${item.name}')">
                <img src="${item.image_url}">
                <div style="padding:10px;">
                    <div style="font-weight:700; font-size:14px;">${item.name}</div>
                    <div style="color:var(--primary); font-weight:800;">${item.price.toLocaleString()} K</div>
                </div>
            </div>
        `).join('');
    }

    function openProduct(name) {
        selectedItem = allItems.find(i => i.name === name);
        const sizes = selectedItem.sizes ? selectedItem.sizes.split(',') : [];
        
        document.getElementById('modal-data').innerHTML = `
            <span onclick="closeModal()" style="position:absolute; right:20px; top:10px; font-size:28px; cursor:pointer;">Ã—</span>
            <img src="${selectedItem.image_url}" class="modal-img">
            <h2 style="margin:15px 0 5px 0;">${selectedItem.name}</h2>
            <div style="color:var(--primary); font-size:24px; font-weight:800;">${selectedItem.price.toLocaleString()} K</div>
            
            <p style="color:#666; font-size:12px;">Premium Stainless Steel, High Quality Finish.</p>
            
            <div style="margin-top:15px;"><b>Select Size:</b></div>
            <div style="display:flex; gap:10px; margin-top:8px;">
                ${sizes.map(s => `<button class="size-btn-modal" onclick="selectSize(this, '${s}')" style="padding:10px 15px; border:1px solid #ddd; border-radius:10px; background:white; cursor:pointer;">${s}</button>`).join('')}
            </div>

            <button class="btn-add-cart" onclick="addToCartFinal()">Add to Cart</button>
            
            <div style="margin-top:20px; font-weight:bold;">Related Products</div>
            <div style="display:flex; overflow-x:auto; gap:10px; margin-top:10px;">
                ${allItems.slice(0,4).map(ri => `<img src="${ri.image_url}" style="width:80px; height:80px; border-radius:10px; flex-shrink:0;">`).join('')}
            </div>
        `;
        document.getElementById('product-modal').style.display = 'flex';
    }

    let tempSize = null;
    function selectSize(btn, size) {
        document.querySelectorAll('.size-btn-modal').forEach(b => b.style.borderColor = '#ddd');
        btn.style.borderColor = 'var(--primary)';
        tempSize = size;
    }

    function addToCartFinal() {
        if(!tempSize && selectedItem.sizes) return alert("Please select a size!");
        cart.push({ ...selectedItem, size: tempSize || 'Free' });
        updateCartUI();
        closeModal();
    }

    function updateCartUI() {
        document.getElementById('cart-count').innerText = cart.length;
        document.getElementById('cart-list').innerHTML = cart.map((item, index) => `
            <div class="cart-item">
                <img src="${item.image_url}" style="width:50px; height:50px; border-radius:8px;">
                <div style="flex:1;">
                    <div style="font-size:13px; font-weight:bold;">${item.name}</div>
                    <div style="font-size:11px; color:#666;">Size: ${item.size}</div>
                </div>
                <div style="font-weight:bold;">${item.price.toLocaleString()} K</div>
                <span onclick="removeItem(${index})" style="color:red; cursor:pointer;">Ã—</span>
            </div>
        `).join('');
        
        const total = cart.reduce((sum, item) => sum + item.price, 0);
        document.getElementById('cart-total').innerText = total.toLocaleString() + " K";
    }

    function removeItem(index) { cart.splice(index, 1); updateCartUI(); }
    function toggleCart() { document.getElementById('cart-drawer').classList.toggle('open'); }
    function closeModal() { document.getElementById('product-modal').style.display = 'none'; tempSize = null; }
    
    window.onload = loadMenu;
</script>
</body>
</html>


<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jewelry Wholesale - Stainless Steel</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --ali-orange: #FF4747; --bg: #F4F4F4; }
        body { font-family: 'Plus Jakarta Sans', 'Pyidaungsu', sans-serif; background: var(--bg); margin: 0; padding-bottom: 100px; }
        .header { background: white; padding: 15px; text-align: center; font-weight: 800; font-size: 20px; color: var(--ali-orange); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .container { max-width: 600px; margin: auto; padding: 15px; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .card img { width: 100%; height: 150px; object-fit: cover; }
        .card-info { padding: 12px; }
        .price { color: var(--ali-orange); font-weight: 800; font-size: 16px; margin: 5px 0; }
        
        /* Size Selector Styling */
        .size-box { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 8px; }
        .size-btn { border: 1px solid #ddd; background: white; padding: 4px 8px; border-radius: 5px; font-size: 11px; cursor: pointer; }
        .size-btn.active { background: var(--ali-orange); color: white; border-color: var(--ali-orange); }
        
        .footer { position: fixed; bottom: 0; width: 100%; max-width: 600px; left: 50%; transform: translateX(-50%); background: white; padding: 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; border-radius: 20px 20px 0 0; }
        .btn-checkout { background: linear-gradient(90deg, #FF8E05, #FF4747); color: white; border: none; padding: 12px 25px; border-radius: 25px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="header">ğŸ’ JEWELRY WHOLESALE</div>

<div class="container">
    <div id="menu-display" class="menu-grid">á€•á€…á€¹á€…á€Šá€ºá€¸á€™á€»á€¬á€¸á€á€„á€ºá€”á€±á€á€Šá€º...</div>
</div>

<div class="footer">
    <div>á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸: <b style="font-size: 1.2rem; color: var(--ali-orange);"><span id="total-price">0</span> K</b></div>
    <button class="btn-checkout" onclick="goToCheckout()">á€¡á€±á€¬á€ºá€’á€«á€á€„á€ºá€™á€Šá€º â”</button>
</div>

<script>
    const SB_URL = "https://ltusknkpwbyriikeyday.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx0dXNrbmtwd2J5cmlpa2V5ZGF5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyMTYxNDksImV4cCI6MjA4MTc5MjE0OX0.7TXAvr2tHl03m_gYZNYq8xyy0yYHTx0sYMN4tS6GDnA";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

    let allItems = [];
    let cart = {}; // cart = { "Ring_Name_Size7": 2 }

    async function loadMenu() {
        const { data, error } = await _supabase.from('menu_items').select('*').order('id');
        if (error) return;
        allItems = data;
        renderMenu(data);
    }

    function renderMenu(items) {
        const display = document.getElementById('menu-display');
        display.innerHTML = items.map(item => {
            // Size á€á€½á€±á€€á€­á€¯ String á€€á€”á€± Array á€•á€¼á€±á€¬á€„á€ºá€¸á€á€¼á€„á€ºá€¸ (á€¥á€•á€™á€¬ "6,7,8" -> ["6","7","8"])
            const sizeList = item.sizes ? item.sizes.split(',') : [];
            
            return `
            <div class="card">
                <img src="${item.image_url}" alt="">
                <div class="card-info">
                    <div style="font-weight:bold; font-size:14px;">${item.name}</div>
                    <div class="price">${item.price.toLocaleString()} K</div>
                    
                    <div style="font-size:11px; color:#666; margin-top:5px;">Size á€›á€½á€±á€¸á€›á€”á€º:</div>
                    <div class="size-box">
                        ${sizeList.map(s => `<button class="size-btn" onclick="addToCart('${item.name}', '${s}', ${item.price}, this)">${s}</button>`).join('')}
                        ${sizeList.length === 0 ? '<span style="font-size:10px;">Free Size</span>' : ''}
                    </div>
                    
                    <div id="status-${item.name}" style="font-size:10px; color:green; margin-top:5px;"></div>
                </div>
            </div>`;
        }).join('');
    }

    function addToCart(name, size, price, btn) {
        const cartKey = `${name} (Size: ${size})`;
        cart[cartKey] = (cart[cartKey] || 0) + 1;
        
        // Button Effect
        btn.classList.add('active');
        setTimeout(() => btn.classList.remove('active'), 200);
        
        document.getElementById(`status-${name}`).innerText = "á€•á€±á€«á€„á€ºá€¸á€‘á€Šá€·á€ºá€•á€¼á€®á€¸";
        calculateTotal();
    }

    function calculateTotal() {
        let total = 0;
        for (let key in cart) {
            const itemName = key.split(' (Size:')[0];
            const item = allItems.find(i => i.name === itemName);
            if (item) total += cart[key] * item.price;
        }
        document.getElementById('total-price').innerText = total.toLocaleString();
    }

    async function goToCheckout() {
        const total = document.getElementById('total-price').innerText;
        if (total === "0") return alert("á€•á€…á€¹á€…á€Šá€ºá€¸ á€¡á€›á€„á€ºá€›á€½á€±á€¸á€á€»á€šá€ºá€•á€«á‹");

        const { data: { user } } = await _supabase.auth.getUser();
        const { error } = await _supabase.from('orders').insert([{
            customer_name: user ? user.user_metadata.full_name : "á€œá€€á€ºá€€á€¬á€¸á€§á€Šá€·á€ºá€á€Šá€º",
            items: cart, // á€¥á€•á€™á€¬ - {"Ring Size 7": 2, "Earring": 5}
            total_price: parseInt(total.replace(/,/g, '')),
            status: 'pending'
        }]);

        if (!error) {
            alert("á€œá€€á€ºá€€á€¬á€¸á€¡á€±á€¬á€ºá€’á€« á€á€„á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹ á€†á€­á€¯á€„á€ºá€™á€¾ á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€•á€¼á€”á€ºá€•á€«á€™á€Šá€ºá‹");
            cart = {}; location.reload();
        }
    }

    window.onload = loadMenu;
</script>
</body>
</html>


<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.M.W Jewelry Wholesale</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #FF4747; --dark: #191919; --bg: #F0F2F5; }
        body { font-family: 'Plus Jakarta Sans', 'Pyidaungsu', sans-serif; background: var(--bg); margin: 0; padding-bottom: 120px; }
        
        /* Navigation & Login */
        .top-nav { background: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 2000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .logo { font-weight: 800; font-size: 22px; color: var(--primary); text-decoration: none; }
        #user-profile { font-size: 13px; display: flex; align-items: center; gap: 8px; }
        .login-btn { background: var(--primary); color: white; padding: 6px 15px; border-radius: 20px; text-decoration: none; font-weight: bold; font-size: 12px; }

        /* Professional Promotion Slider */
        .promo-slider { margin: 15px; height: 180px; background: linear-gradient(135deg, #FF4747 0%, #FF8E05 100%); border-radius: 20px; position: relative; overflow: hidden; color: white; display: flex; align-items: center; padding: 25px; box-sizing: border-box; }
        .promo-slider h2 { margin: 0; font-size: 24px; font-weight: 800; }
        .promo-slider p { margin: 5px 0; font-size: 14px; opacity: 0.9; }
        .promo-tag { background: white; color: var(--primary); padding: 4px 10px; border-radius: 10px; font-size: 12px; font-weight: bold; }
        .promo-img { position: absolute; right: -20px; bottom: -20px; width: 150px; opacity: 0.8; transform: rotate(-15px); }

        .section-title { padding: 0 20px; font-size: 18px; font-weight: 800; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        
        /* Products Grid */
        .container { max-width: 600px; margin: auto; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 15px; }
        .card { background: white; border-radius: 16px; overflow: hidden; border: 1px solid rgba(0,0,0,0.03); box-shadow: 0 4px 15px rgba(0,0,0,0.04); transition: 0.3s; }
        .card img { width: 100%; height: 160px; object-fit: cover; }
        .card-info { padding: 12px; }
        .price { color: var(--primary); font-weight: 800; font-size: 18px; margin: 5px 0; }
        
        /* Size Buttons */
        .size-box { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }
        .size-btn { border: 1px solid #eee; background: #f9f9f9; padding: 6px 10px; border-radius: 8px; font-size: 11px; cursor: pointer; font-weight: 600; }
        .size-btn:active { background: var(--primary); color: white; }

        /* Floating Checkout Bar */
        .footer { position: fixed; bottom: 0; width: 100%; max-width: 600px; left: 50%; transform: translateX(-50%); background: white; padding: 20px; box-shadow: 0 -10px 30px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; border-radius: 25px 25px 0 0; z-index: 1000; }
        .btn-main { background: linear-gradient(90deg, #FF8E05, #FF4747); color: white; border: none; padding: 14px 30px; border-radius: 20px; font-weight: 800; cursor: pointer; }
        
        #toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: var(--dark); color: white; padding: 10px 20px; border-radius: 30px; font-size: 12px; display: none; z-index: 3000; }
    </style>
</head>
<body>

<div id="toast">Cart ·Äë·Ä≤·Äû·Ä≠·ÄØ·Ä∑ ·Äë·Ää·Ä∑·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ ‚ú®</div>

<div class="top-nav">
    <a href="index.html" class="logo">K.M.W</a>
    <div id="user-profile">·ÄÖ·ÄÖ·Ä∫·ÄÜ·Ä±·Ä∏·Äî·Ä±·Äû·Ää·Ä∫...</div>
</div>

<div class="promo-slider">
    <div>
        <span class="promo-tag">Promotion</span>
        <h2>New Arrivals</h2>
        <p>Stainless Steel Rings<br>·Äú·ÄÄ·Ä∫·ÄÄ·Ä¨·Ä∏·Äà·Ä±·Ä∏ ·ÅÖ·ÅÄ% ·Ä°·Äë·Ä∞·Ä∏·Äú·Äª·Äæ·Ä±·Ä¨·Ä∑·Äà·Ä±·Ä∏</p>
    </div>
    <img src="https://via.placeholder.com/150" class="promo-img" alt="Jewelry">
</div>

<div class="container">
    <div class="section-title">
        <span>Products üî•</span>
        <span style="font-size: 12px; color: var(--primary);">·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·ÄÄ·Äº·Ää·Ä∑·Ä∫·Äõ·Äî·Ä∫</span>
    </div>
    <div id="menu-display" class="menu-grid">Loading products...</div>
</div>

<div class="footer">
    <div>
        <div style="font-size: 12px; color: #666;">Total Amount</div>
        <b style="font-size: 22px; color: var(--primary);"><span id="total-price">0</span> K</b>
    </div>
    <button class="btn-main" onclick="goToCheckout()">Check Out ‚ûî</button>
</div>

<script>
    const SB_URL = "https://ltusknkpwbyriikeyday.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx0dXNrbmtwd2J5cmlpa2V5ZGF5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyMTYxNDksImV4cCI6MjA4MTc5MjE0OX0.7TXAvr2tHl03m_gYZNYq8xyy0yYHTx0sYMN4tS6GDnA";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

    let allItems = [];
    let cart = {};

    // ·ÅÅ·Åã Login System Check
    async function checkUser() {
        const { data: { user } } = await _supabase.auth.getUser();
        const profileDiv = document.getElementById('user-profile');
        if (user) {
            profileDiv.innerHTML = `
                <img src="${user.user_metadata.avatar_url || 'https://api.dicebear.com/7.x/avataaars/svg?seed=Jewelry'}" style="width:30px; height:30px; border-radius:50%;">
                <span style="font-weight:bold;">${user.user_metadata.full_name || 'User'}</span>
                <button onclick="logout()" style="border:none; background:none; color:red; cursor:pointer; font-size:11px;">(·Äë·ÄΩ·ÄÄ·Ä∫·Äõ·Äî·Ä∫)</button>`;
        } else {
            profileDiv.innerHTML = `<a href="auth.html" class="login-btn">Login / Register</a>`;
        }
    }

    async function logout() { await _supabase.auth.signOut(); location.reload(); }

    // ·ÅÇ·Åã Load Products
    async function loadMenu() {
        const { data, error } = await _supabase.from('menu_items').select('*').order('id');
        if (error) return;
        allItems = data;
        renderMenu(data);
    }

    function renderMenu(items) {
        const display = document.getElementById('menu-display');
        display.innerHTML = items.map(item => {
            const sizeList = item.sizes ? item.sizes.split(',') : [];
            return `
            <div class="card">
                <img src="${item.image_url || 'https://via.placeholder.com/150'}" alt="">
                <div class="card-info">
                    <div style="font-weight:700; font-size:14px; color:var(--dark);">${item.name}</div>
                    <div class="price">${item.price.toLocaleString()} K</div>
                    <div style="font-size:10px; color:#999;">Select Size:</div>
                    <div class="size-box">
                        ${sizeList.map(s => `<button class="size-btn" onclick="addToCart('${item.name}', '${s.trim()}', ${item.price})">${s.trim()}</button>`).join('')}
                        ${sizeList.length === 0 ? `<button class="size-btn" onclick="addToCart('${item.name}', 'Free', ${item.price})">Free Size</button>` : ''}
                    </div>
                </div>
            </div>`;
        }).join('');
    }

    function addToCart(name, size, price) {
        const cartKey = `${name} (Size: ${size})`;
        cart[cartKey] = (cart[cartKey] || 0) + 1;
        
        const toast = document.getElementById('toast');
        toast.style.display = 'block';
        setTimeout(() => toast.style.display = 'none', 1000);

        calculateTotal();
    }

    function calculateTotal() {
        let total = 0;
        for (let key in cart) {
            const itemName = key.split(' (Size:')[0];
            const item = allItems.find(i => i.name === itemName);
            if (item) total += cart[key] * item.price;
        }
        document.getElementById('total-price').innerText = total.toLocaleString();
    }

    async function goToCheckout() {
        const total = document.getElementById('total-price').innerText;
        if (total === "0") return alert("·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏ ·Ä°·Äõ·ÄÑ·Ä∫·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äï·Ä´·Åã");

        const { data: { user } } = await _supabase.auth.getUser();
        if(!user) return alert("·Ä°·Ä±·Ä¨·Ä∫·Äí·Ä´·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫ Login ·Ä°·Äõ·ÄÑ·Ä∫·Äù·ÄÑ·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´·Åã");

        const { error } = await _supabase.from('orders').insert([{
            customer_name: user.user_metadata.full_name || user.email,
            items: cart,
            total_price: parseInt(total.replace(/,/g, '')),
            status: 'pending'
        }]);

        if (!error) {
            alert("·Äô·Äæ·Ä¨·Äö·Ä∞·Äô·Äæ·ÄØ ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã");
            cart = {}; location.reload();
        }
    }

    window.onload = async () => { await checkUser(); await loadMenu(); };
</script>
</body>
</html>


<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - á€™á€¼á€„á€ºá€á€¬á€€á€¼á€€á€ºá€€á€„á€º</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, select { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-add { background: #2ecc71; color: white; }
        .item-list { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .item { background: white; padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #eee; }
        .item img { width: 50px; height: 50px; border-radius: 5px; object-fit: cover; }
    </style>
</head>
<body>

<h2>ğŸ— Admin Panel (Menu á€…á€®á€™á€¶á€›á€”á€º)</h2>

<div class="card">
    <h3>â• á€™á€®á€”á€°á€¸á€¡á€á€…á€ºá€‘á€Šá€·á€ºá€›á€”á€º</h3>
    <input type="text" id="name" placeholder="á€Ÿá€„á€ºá€¸á€•á€½á€²á€¡á€™á€Šá€º">
    <input type="number" id="price" placeholder="á€…á€»á€±á€¸á€”á€¾á€¯á€”á€ºá€¸">
    <input type="number" id="stock" placeholder="Stock á€¡á€›á€±á€¡á€á€½á€€á€º">
    <select id="category">
        <option value="single">á€á€…á€ºá€á€¯á€á€»á€„á€ºá€¸</option>
        <option value="set-10000">áá€á€á€á€ á€á€”á€ºá€†á€•á€º</option>
        <option value="set-20000">á‚á€á€á€á€ á€á€”á€ºá€†á€•á€º</option>
    </select>
    <label>á€•á€¯á€¶á€›á€½á€±á€¸á€•á€« (á€–á€¯á€”á€ºá€¸á€‘á€²á€™á€¾):</label>
    <input type="file" id="fileInput" accept="image/*">
    <button class="btn-add" onclick="uploadAndSave()">á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€™á€Šá€º</button>
</div>

<div class="card">
    <h3>ğŸ“¦ á€œá€€á€ºá€›á€¾á€­á€™á€®á€”á€°á€¸á€™á€»á€¬á€¸</h3>
    <div id="admin-menu-list" class="item-list">á€’á€±á€á€¬á€™á€»á€¬á€¸ á€†á€½á€²á€šá€°á€”á€±á€á€Šá€º...</div>
</div>

<script>
    const SB_URL = "https://deabtvqzxpkepgcdutzd.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlYWJ0dnF6eHBrZXBnY2R1dHpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNzQzNDMsImV4cCI6MjA4MTg1MDM0M30.BbxmM65uoTDcf_nTP6w5siSF6Y5_eM4peqYJCAxR90I";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

    async function uploadAndSave() {
        const file = document.getElementById('fileInput').files[0];
        const name = document.getElementById('name').value;
        const price = document.getElementById('price').value;
        const stock = document.getElementById('stock').value;
        const cat = document.getElementById('category').value;

        if (!file || !name || !price) return alert("á€¡á€á€»á€€á€ºá€¡á€œá€€á€º á€¡á€€á€¯á€”á€ºá€–á€¼á€Šá€·á€ºá€•á€«");

        // 1. Upload Image to Storage
        const fileName = Date.now() + "_" + file.name;
        const { data: uploadData, error: uploadError } = await _supabase.storage
            .from('menu-images')
            .upload(fileName, file);

        if (uploadError) return alert("Upload Error: " + uploadError.message);

        // 2. Get Public URL
        const { data: urlData } = _supabase.storage.from('menu-images').getPublicUrl(fileName);
        const imgUrl = urlData.publicUrl;

        // 3. Save to Database
        const { error: dbError } = await _supabase.from('menu_items').insert([
            { name: name, price: parseInt(price), stock_qty: parseInt(stock), category: cat, image_url: imgUrl }
        ]);

        if (dbError) alert("DB Error: " + dbError.message);
        else { alert("á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€…á€½á€¬ á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®"); location.reload(); }
    }

    async function loadMenu() {
        const { data } = await _supabase.from('menu_items').select('*').order('id', { ascending: false });
        const list = document.getElementById('admin-menu-list');
        list.innerHTML = data.map(item => `
            <div class="item">
                <img src="${item.image_url || 'https://via.placeholder.com/50'}" alt="">
                <div>
                    <b>${item.name}</b><br>
                    <small>${item.price} K | Stock: ${item.stock_qty}</small>
                </div>
                <button onclick="deleteItem(${item.id})" style="width:auto; background:#ff4757; color:white; padding:5px 10px;">á€–á€»á€€á€ºá€›á€”á€º</button>
            </div>
        `).join('');
    }

    async function deleteItem(id) {
        if (confirm("á€–á€»á€€á€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) {
            await _supabase.from('menu_items').delete().eq('id', id);
            location.reload();
        }
    }

    window.onload = loadMenu;
</script>
</body>
</html>

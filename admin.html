<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.M.W Admin Center</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #FF4747; --dark: #191919; --bg: #f4f7f6; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        
        /* Login Overlay */
        #login-screen { position: fixed; inset: 0; background: var(--dark); z-index: 9999; display: flex; align-items: center; justify-content: center; color: white; }
        .login-box { background: #222; padding: 40px; border-radius: 20px; text-align: center; width: 300px; }
        
        .container { max-width: 900px; margin: auto; display: none; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .btn { padding: 12px 20px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; }
        .btn-add { background: var(--primary); color: white; }
        .btn-update { background: #27ae60; color: white; width: auto; }
        
        .tab-btn { padding: 10px 20px; cursor: pointer; border: none; background: #eee; border-radius: 8px; margin-right: 5px; font-weight: bold; }
        .tab-btn.active { background: var(--dark); color: white; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <h2>K.M.W Admin</h2>
        <input type="password" id="admin-pass" placeholder="Password á€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€«" style="text-align: center;">
        <button class="btn btn-add" onclick="checkLogin()">Login</button>
    </div>
</div>

<div class="container" id="main-content">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2>ğŸ›  Admin Dashboard</h2>
        <button onclick="location.reload()">Refresh</button>
    </div>

    <div style="margin-bottom: 20px;">
        <button class="tab-btn active" onclick="showTab('tab-orders', this)">Orders</button>
        <button class="tab-btn" onclick="showTab('tab-add', this)">+ á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€á€…á€ºá€á€„á€ºá€›á€”á€º</button>
        <button class="tab-btn" onclick="showTab('tab-items', this)">á€•á€…á€¹á€…á€Šá€ºá€¸á€™á€»á€¬á€¸á€…á€®á€™á€¶á€›á€”á€º</button>
    </div>

    <div id="tab-orders" class="tab-content card">
        <h3>ğŸ“ á€™á€¾á€¬á€šá€°á€™á€¾á€¯á€…á€¬á€›á€„á€ºá€¸</h3>
        <div id="order-list">Loading...</div>
    </div>

    <div id="tab-add" class="tab-content card hidden">
        <h3>ğŸ’ á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€á€…á€ºá€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€á€¼á€„á€ºá€¸</h3>
        <label>á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€º</label>
        <input type="text" id="new-name" placeholder="á€¥á€•á€™á€¬ - á€›á€½á€¾á€±á€œá€€á€ºá€…á€½á€•á€º">
        <label>á€…á€»á€±á€¸á€”á€¾á€¯á€”á€ºá€¸ (MMK)</label>
        <input type="number" id="new-price" placeholder="á€¥á€•á€™á€¬ - 15000">
        <label>á€•á€¯á€¶ Link (Image URL)</label>
        <input type="text" id="new-img" placeholder="https://example.com/photo.jpg">
        <label>á€›á€›á€¾á€­á€”á€­á€¯á€„á€ºá€á€±á€¬ Size á€™á€»á€¬á€¸ (á€€á€±á€¬á€ºá€™á€¬á€á€¼á€¬á€¸á€•á€«)</label>
        <input type="text" id="new-sizes" placeholder="S, M, L, XL">
        <button class="btn btn-add" style="margin-top:10px;" onclick="addNewProduct()">á€á€„á€ºá€™á€Šá€º (Upload)</button>
    </div>

    <div id="tab-items" class="tab-content card hidden">
        <h3>ğŸ“¦ á€œá€€á€ºá€›á€¾á€­á€•á€…á€¹á€…á€Šá€ºá€¸á€™á€»á€¬á€¸</h3>
        <div id="item-list">Loading...</div>
    </div>
</div>

<script>
    const SB_URL = "https://ltusknkpwbyriikeyday.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx0dXNrbmtwd2J5cmlpa2V5ZGF5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyMTYxNDksImV4cCI6MjA4MTc5MjE0OX0.7TXAvr2tHl03m_gYZNYq8xyy0yYHTx0sYMN4tS6GDnA";
    const _supabase = window.supabase.createClient(SB_URL, SB_KEY);

    // áá‹ Password á€…á€…á€ºá€†á€±á€¸á€á€¼á€„á€ºá€¸
    function checkLogin() {
        const pass = document.getElementById('admin-pass').value;
        if(pass === "kmw123") { // á€’á€®á€™á€¾á€¬ Password á€•á€¼á€„á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€º
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            loadAllData();
        } else {
            alert("Password á€™á€¾á€¬á€¸á€šá€½á€„á€ºá€¸á€”á€±á€•á€«á€á€Šá€ºá‹");
        }
    }

    async function loadAllData() {
        // Orders
        const { data: orders } = await _supabase.from('orders').select('*').order('created_at', {ascending: false});
        document.getElementById('order-list').innerHTML = orders.map(o => `
            <div style="border-bottom:1px solid #eee; padding:15px 0;">
                <b>#${o.id.toString().slice(-5)} - ${o.customer_name}</b> (${o.status})<br>
                <small>${o.phone} | ${o.address}</small><br>
                <b style="color:var(--primary);">${o.total_price.toLocaleString()} K</b>
                <button onclick="updateStatus(${o.id}, 'Shipped')" style="float:right;">Shipped á€•á€­á€¯á€·á€•á€¼á€®á€¸</button>
            </div>
        `).join('');

        // Items
        const { data: items } = await _supabase.from('menu_items').select('*').order('created_at', {ascending: false});
        document.getElementById('item-list').innerHTML = items.map(i => `
            <div style="display:flex; gap:10px; margin-bottom:10px; align-items:center; background:#f9f9f9; padding:10px; border-radius:10px;">
                <img src="${i.image_url}" width="50" height="50" style="border-radius:5px; object-fit:cover;">
                <div style="flex:1;"><b>${i.name}</b><br>${i.price} K</div>
                <button onclick="deleteProduct(${i.id})" style="color:red; background:none; border:none; cursor:pointer;">á€–á€»á€€á€ºá€™á€Šá€º</button>
            </div>
        `).join('');
    }

    // á‚á‹ á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€á€…á€ºá€á€„á€ºá€á€¼á€„á€ºá€¸
    async function addNewProduct() {
        const name = document.getElementById('new-name').value;
        const price = document.getElementById('new-price').value;
        const img = document.getElementById('new-img').value;
        const sizes = document.getElementById('new-sizes').value;

        if(!name || !price || !img) return alert("á€¡á€á€»á€€á€ºá€¡á€œá€€á€º á€¡á€•á€¼á€Šá€·á€ºá€¡á€…á€¯á€¶á€–á€¼á€Šá€·á€ºá€•á€«!");

        const { error } = await _supabase.from('menu_items').insert([{
            name: name, price: parseInt(price), image_url: img, sizes: sizes
        }]);

        if(!error) {
            alert("á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€á€…á€º á€á€„á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®!");
            location.reload();
        }
    }

    async function deleteProduct(id) {
        if(confirm("á€’á€®á€•á€…á€¹á€…á€Šá€ºá€¸á€€á€­á€¯ á€–á€»á€€á€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€á€œá€¬á€¸?")) {
            await _supabase.from('menu_items').delete().eq('id', id);
            loadAllData();
        }
    }

    async function updateStatus(id, status) {
        await _supabase.from('orders').update({ status: status }).eq('id', id);
        loadAllData();
    }

    function showTab(tabId, btn) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.remove('hidden');
        btn.classList.add('active');
    }
</script>
</body>
</html>


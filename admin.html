<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.M.W Premium Wholesale</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary: #FF4747;
            --secondary: #1A1A1A;
            --accent: #FFD700;
            --bg: #F8F9FA;
            --glass: rgba(255, 255, 255, 0.9);
            --shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        body {
            margin: 0; font-family: 'Segoe UI', Roboto, sans-serif;
            background: var(--bg); color: var(--secondary);
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        /* Premium Header */
        header {
            background: var(--glass); backdrop-filter: blur(10px);
            padding: 15px 20px; display: flex; justify-content: space-between;
            align-items: center; position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .logo { font-size: 22px; font-weight: 800; color: var(--primary); letter-spacing: 1px; }

        /* Admin/Shop View Toggle */
        .main-container { padding: 15px; }
        .page { display: none; animation: slideUp 0.4s ease-out; }
        .active { display: block; }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Premium Product Cards */
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .p-card {
            background: #fff; border-radius: 20px; overflow: hidden;
            box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.03);
            transition: 0.3s;
        }
        .p-card:active { transform: scale(0.95); }
        .p-card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        .p-info { padding: 12px; }
        .p-name { font-weight: 600; font-size: 14px; margin-bottom: 5px; height: 35px; overflow: hidden; }
        .p-price { color: var(--primary); font-weight: 800; font-size: 16px; }

        /* Admin Panel Premium UI */
        .admin-section { background: #fff; padding: 20px; border-radius: 25px; margin-bottom: 20px; box-shadow: var(--shadow); }
        input, textarea, select {
            width: 100%; padding: 12px 15px; margin: 8px 0; border-radius: 12px;
            border: 1.5px solid #EEE; outline: none; transition: 0.3s; font-size: 14px;
        }
        input:focus { border-color: var(--primary); }

        .btn-premium {
            background: var(--primary); color: #fff; border: none;
            padding: 15px; border-radius: 15px; width: 100%;
            font-weight: bold; font-size: 16px; box-shadow: 0 4px 15px rgba(255, 71, 71, 0.3);
            cursor: pointer;
        }

        /* Detail Page Premium */
        .detail-img { width: 100%; border-radius: 30px; margin-bottom: 20px; box-shadow: var(--shadow); }
        .wholesale-badge {
            background: #FFF5F5; color: var(--primary); padding: 5px 12px;
            border-radius: 10px; font-size: 12px; font-weight: bold; margin-right: 5px;
        }

        /* Quantity Controller */
        .qty-control {
            display: flex; align-items: center; justify-content: center;
            background: #F1F3F5; padding: 10px; border-radius: 20px; margin: 20px 0;
        }
        .qty-btn {
            width: 45px; height: 45px; border: none; background: #fff;
            border-radius: 15px; font-size: 20px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        #qtyInput { width: 80px; background: transparent; border: none; font-size: 20px; text-align: center; }

        /* Bottom Navigation */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; background: var(--glass);
            backdrop-filter: blur(15px); display: flex; justify-content: space-around;
            padding: 15px 0; border-top: 1px solid rgba(0,0,0,0.05); z-index: 2000;
        }
        .nav-item { color: #888; font-size: 12px; text-align: center; flex: 1; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }

        /* Toast Sound Notification */
        #toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: var(--secondary); color: #fff; padding: 12px 25px;
            border-radius: 50px; display: none; z-index: 3000; font-size: 14px;
        }
    </style>
</head>
<body>

<div id="toast">‚úÖ ·Äú·ÄØ·Äï·Ä∫·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫ ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫</div>

<header>
    <div class="logo">K.M.W</div>
    <div id="admin-trigger" onclick="checkAdmin()"><i class="fas fa-user-shield" style="font-size: 20px; color: #555;"></i></div>
</header>

<div class="main-container">
    <div id="shop-page" class="page active">
        <div class="product-grid" id="product-list">
            </div>
    </div>

    <div id="detail-page" class="page">
        <button onclick="navigate('shop-page')" style="background:none; border:none; margin-bottom:15px; font-weight:bold;"><i class="fas fa-chevron-left"></i> Back</button>
        <div id="product-detail"></div>
    </div>

    <div id="admin-page" class="page">
        <h2 style="margin-bottom: 25px;">Admin Control</h2>
        
        <div class="admin-section">
            <h3>‚ûï Add New Item</h3>
            <input type="text" id="p-name" placeholder="Item Name">
            <input type="text" id="p-img" placeholder="Image Link (URL)">
            <textarea id="p-desc" placeholder="Product Description" rows="3"></textarea>
            <input type="number" id="p-base" placeholder="Retail Price (1 pcs price)">
            
            <p style="font-size: 13px; font-weight: bold; margin-top: 15px;">Wholesale Prices (·Äú·ÄÄ·Ä∫·ÄÄ·Ä¨·Ä∏·Äà·Ä±·Ä∏·Äô·Äª·Ä¨·Ä∏)</p>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="p-q1" placeholder="Min Qty (e.g. 10)">
                <input type="number" id="p-pr1" placeholder="Price per unit">
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="p-q2" placeholder="Min Qty (e.g. 30)">
                <input type="number" id="p-pr2" placeholder="Price per unit">
            </div>

            <input type="text" id="p-variants" placeholder="Variants (e.g. Red, Blue, XL, L)">
            <button class="btn-premium" onclick="saveProduct()">Save Product</button>
        </div>

        <div class="admin-section">
            <h3>üì¶ Incoming Orders</h3>
            <div id="order-list"></div>
        </div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item active" onclick="navigate('shop-page', this)"><i class="fas fa-home"></i>Home</div>
    <div class="nav-item" onclick="navigate('shop-page', this)"><i class="fas fa-th-large"></i>Catalog</div>
    <div class="nav-item" onclick="showHistory()"><i class="fas fa-history"></i>History</div>
    <div class="nav-item" onclick="checkAdmin()"><i class="fas fa-cog"></i>Admin</div>
</div>

<script>
    // Configuration
    const SB_URL = "https://ltusknkpwbyriikeyday.supabase.co";
    const SB_KEY = "YOUR_ANON_KEY"; 
    const _supa = supabase.createClient(SB_URL, SB_KEY);
    const ADMIN_PASS = "kmw123";
    
    let products = [];
    const popSound = new Audio('https://www.soundjay.com/button/button-16.mp3');
    const successSound = new Audio('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3');

    // UI Navigation
    function navigate(pageId, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        if(el) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }
        window.scrollTo(0,0);
    }

    // Sound and Toast
    function notify(msg) {
        successSound.play();
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 3000);
    }

    // Admin Auth
    function checkAdmin() {
        if(prompt("Enter Admin Password:") === ADMIN_PASS) {
            navigate('admin-page');
            loadOrders();
        } else {
            alert("·Äô·Äæ·Ä¨·Ä∏·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫·Åã");
        }
    }

    // Load Data
    async function loadProducts() {
        const { data } = await _supa.from('products').select('*').order('id', {ascending: false});
        products = data || [];
        renderShop();
    }

    function renderShop() {
        const list = document.getElementById('product-list');
        list.innerHTML = products.map(p => `
            <div class="p-card" onclick="openProduct(${p.id})">
                <img src="${p.image_url}">
                <div class="p-info">
                    <div class="p-name">${p.name}</div>
                    <div class="p-price">${p.base_price.toLocaleString()} Ks</div>
                </div>
            </div>
        `).join('');
    }

    // Wholesale Price Logic
    function getPrice(qty, p) {
        let price = p.base_price;
        try {
            const tiers = JSON.parse(p.wholesale_options || "[]");
            tiers.sort((a,b) => b.min - a.min).forEach(t => {
                if(qty >= t.min) price = t.price;
            });
        } catch(e) {}
        return price;
    }

    // Detail View
    function openProduct(id) {
        const p = products.find(x => x.id === id);
        navigate('detail-page');
        const variants = p.variants ? p.variants.split(',') : [];
        
        document.getElementById('product-detail').innerHTML = `
            <img src="${p.image_url}" class="detail-img">
            <h2>${p.name}</h2>
            <div style="margin-bottom:15px;">
                ${JSON.parse(p.wholesale_options || "[]").map(t => `<span class="wholesale-badge">${t.min}+ ·Äú·Äª·Äæ·Ä±·Ä¨·Ä∑·Äà·Ä±·Ä∏: ${t.price}</span>`).join('')}
            </div>
            <p style="color:#666; font-size:14px; line-height:1.6;">${p.description || ''}</p>
            <h1 id="total-price" style="color:var(--primary);">${p.base_price.toLocaleString()} Ks</h1>

            <label style="font-weight:bold; display:block; margin-bottom:8px;">·Ä°·Äõ·ÄΩ·Äö·Ä∫·Ä°·ÄÖ·Ä¨·Ä∏/·Ä°·Äõ·Ä±·Ä¨·ÄÑ·Ä∫ ·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äõ·Äî·Ä∫:</label>
            <select id="v-select">
                ${variants.map(v => `<option value="${v.trim()}">${v.trim()}</option>`).join('')}
            </select>

            <div class="qty-control">
                <button class="qty-btn" onclick="updateQty(-1, ${p.id})">-</button>
                <input type="number" id="qtyInput" value="1" oninput="recalc(${p.id})">
                <button class="qty-btn" onclick="updateQty(1, ${p.id})">+</button>
            </div>

            <button class="btn-premium" onclick="placeOrder(${p.id})">Checkout Order</button>
        `;
    }

    function updateQty(n, pid) {
        popSound.play();
        const inp = document.getElementById('qtyInput');
        inp.value = Math.max(1, parseInt(inp.value || 1) + n);
        recalc(pid);
    }

    function recalc(pid) {
        const p = products.find(x => x.id === pid);
        const qty = parseInt(document.getElementById('qtyInput').value || 1);
        const unitPrice = getPrice(qty, p);
        document.getElementById('total-price').innerText = (unitPrice * qty).toLocaleString() + " Ks";
    }

    // Admin: Save Product
    async function saveProduct() {
        const name = document.getElementById('p-name').value;
        const img = document.getElementById('p-img').value;
        const base = parseInt(document.getElementById('p-base').value);
        
        const tiers = [];
        if(document.getElementById('p-q1').value) tiers.push({min: parseInt(document.getElementById('p-q1').value), price: parseInt(document.getElementById('p-pr1').value)});
        if(document.getElementById('p-q2').value) tiers.push({min: parseInt(document.getElementById('p-q2').value), price: parseInt(document.getElementById('p-pr2').value)});

        const { error } = await _supa.from('products').insert([{
            name, image_url: img, base_price: base, 
            description: document.getElementById('p-desc').value,
            variants: document.getElementById('p-variants').value,
            wholesale_options: JSON.stringify(tiers)
        }]);

        if(!error) {
            notify("Item ·Ä°·Äû·ÄÖ·Ä∫·Äê·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ");
            loadProducts();
            navigate('shop-page');
        }
    }

    // Order View for Admin
    async function loadOrders() {
        const { data } = await _supa.from('orders').select('*').order('id', {ascending: false});
        document.getElementById('order-list').innerHTML = data.map(o => `
            <div style="border-bottom: 1px solid #eee; padding: 15px 0;">
                <div style="display:flex; justify-content:space-between;">
                    <b>ID: #${o.id.toString().slice(-5)}</b>
                    <span style="color:var(--primary); font-weight:bold;">${o.total_price.toLocaleString()} Ks</span>
                </div>
                <div style="font-size:12px; color:#777;">${new Date(o.created_at).toLocaleString()}</div>
                <div style="margin-top:5px; font-size:14px;">${o.items_summary}</div>
            </div>
        `).join('');
    }

    loadProducts();
</script>
</body>
</html>

